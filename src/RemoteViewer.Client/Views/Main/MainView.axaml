<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:RemoteViewer.Client.Controls"
        xmlns:vm="using:RemoteViewer.Client.Views.Main"
        xmlns:conv="using:RemoteViewer.Client.Converters"
        xmlns:toastControls="using:RemoteViewer.Client.Controls.Toasts"
        xmlns:mi="using:Material.Icons.Avalonia"
        xmlns:mik="using:Material.Icons"

        x:Class="RemoteViewer.Client.Views.Main.MainView"
        x:DataType="vm:MainViewModel"

        Icon="/Assets/avalonia-logo.ico"
        Title="Remote Viewer"
        CanResize="False"

        Width="500"
        Height="240"

        DataContextChanged="Window_DataContextChanged">
    <Panel>
        <!-- Main Content -->
        <DockPanel>
            <!-- Status Bar at Bottom -->
            <Border DockPanel.Dock="Bottom"
                    Classes="bg-elevated px-md py-sm">
                <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Classes="flex-row gap-sm">
                        <mi:MaterialIcon Kind="{Binding IsConnected, Converter={conv:BoolToObject TrueValue={x:Static mik:MaterialIconKind.CloudCheck}, FalseValue={x:Static mik:MaterialIconKind.CloudOffOutline}}}"
                                         Width="{StaticResource IconSizeSM}" Height="{StaticResource IconSizeSM}"
                                         Foreground="{Binding IsConnected, Converter={conv:BoolToObject TrueValue={StaticResource SuccessBrush}, FalseValue={StaticResource ErrorBrush}}}"/>
                        <TextBlock Text="{Binding StatusText}"
                                   Classes="caption justify-center"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Command="{Binding ShowAboutCommand}"
                            ToolTip.Tip="About"
                            Classes="icon-button"
                            Width="24" Height="24">
                        <mi:MaterialIcon Kind="InformationOutline" Width="16" Height="16"
                                         Classes="text-secondary"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Main Content -->
            <Grid ColumnDefinitions="*,*" Classes="m-lg">
                <!-- Left Panel - Your Credentials -->
                <Border Grid.Column="0"
                        Classes="card-lg mr-sm">
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                        <!-- Row 0: Title -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                                   Text="Your Credentials"
                                   Classes="header-small mb-md"/>

                        <!-- Row 1: ID Label + Value -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Classes="gap-xs">
                            <TextBlock Text="ID"
                                       Classes="caption secondary"/>
                            <SelectableTextBlock Text="{Binding YourUsername}"
                                                 Classes="credential my-sm"/>
                        </StackPanel>

                        <!-- Copy button - spans rows 1-2, vertically centered -->
                        <Button Grid.Row="1" Grid.RowSpan="2" Grid.Column="1"
                                Classes="icon-button justify-center ml-sm"
                                Command="{Binding CopyCredentialsCommand}"
                                ToolTip.Tip="Copy ID and password">
                            <mi:MaterialIcon Kind="ContentCopy" Width="20" Height="20"
                                             Classes="text-secondary"/>
                        </Button>

                        <!-- Row 2: Password Label + Value with Refresh -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Classes="gap-xs mt-md">
                            <TextBlock Text="Password"
                                       Classes="caption secondary"/>
                            <StackPanel Classes="flex-row gap-xs">
                                <SelectableTextBlock Text="{Binding YourPassword}"
                                                     Classes="credential my-sm justify-center"/>
                                <Button Command="{Binding GenerateNewPasswordCommand}"
                                        ToolTip.Tip="Generate new password"
                                        Classes="icon-button justify-center"
                                        Width="28" Height="28">
                                    <mi:MaterialIcon Kind="Refresh" Width="18" Height="18"
                                                     Classes="text-secondary"/>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Right Panel - Connect to Device -->
                <Border Grid.Column="1"
                        Classes="card-lg ml-sm">
                    <StackPanel Classes="gap-md">
                        <TextBlock Text="Connect to Device"
                                   Classes="header-small"/>

                        <StackPanel Classes="gap-xs">
                            <TextBlock Text="ID"
                                       Classes="caption secondary"/>
                            <TextBox x:Name="TargetUsernameBox"
                                     Text="{Binding TargetUsername}"
                                     Watermark="Enter ID"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     PastingFromClipboard="TargetUsernameBox_Pasting"/>
                        </StackPanel>

                        <StackPanel Classes="gap-xs">
                            <TextBlock Text="Password"
                                       Classes="caption secondary"/>
                            <TextBox x:Name="TargetPasswordBox"
                                     Text="{Binding TargetPassword}"
                                     Watermark="Enter password"
                                     PasswordChar="*"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     KeyDown="TargetPasswordBox_KeyDown">
                                <TextBox.InnerRightContent>
                                    <Button Command="{Binding ConnectToDeviceCommand}"
                                            ToolTip.Tip="Connect"
                                            Classes="icon-button p-xs"
                                            IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}">
                                        <mi:MaterialIcon Kind="ArrowRightCircle" Width="20" Height="20"
                                                         Classes="text-accent"/>
                                    </Button>
                                </TextBox.InnerRightContent>
                            </TextBox>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </DockPanel>

        <toastControls:ToastsView DataContext="{Binding Toasts}"
                                  Classes="items-end justify-end mr-sm mb-sm"/>

        <!-- Version Mismatch Warning Banner (overlay) -->
        <Border Classes="items-stretch justify-start px-md py-sm"
                Background="{DynamicResource WarningBackgroundBrush}"
                IsVisible="{Binding HasVersionMismatch}">
            <Grid ColumnDefinitions="Auto,*">
                <mi:MaterialIcon Kind="AlertOutline"
                                 Width="20" Height="20"
                                 Foreground="{DynamicResource WarningForegroundBrush}"
                                 Classes="justify-center mr-md"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding VersionMismatchText}"
                           Foreground="{DynamicResource WarningForegroundBrush}"
                           Classes="justify-center"/>
            </Grid>
        </Border>
    </Panel>
</Window>
