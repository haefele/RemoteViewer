<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RemoteViewer.Client.Views.Main"
        xmlns:conv="using:RemoteViewer.Client.Converters"
        xmlns:toastControls="using:RemoteViewer.Client.Controls.Toasts"
        xmlns:mi="using:Material.Icons.Avalonia"

        x:Class="RemoteViewer.Client.Views.Main.MainView"
        x:DataType="vm:MainViewModel"

        Icon="/Assets/avalonia-logo.ico"
        Title="Remote Viewer"
        CanResize="False"

        Width="500"
        Height="240"

        DataContextChanged="Window_DataContextChanged">
    <Panel>
        <!-- Main Content -->
        <DockPanel>
            <!-- Status Bar at Bottom -->
            <Border DockPanel.Dock="Bottom"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                    Padding="10,6">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="{Binding IsConnected, Converter={x:Static conv:BoolToConnectionIconConverter.Instance}}"
                                     Width="16" Height="16"
                                     Foreground="{Binding IsConnected, Converter={x:Static conv:BoolToColorConverter.Instance}}"/>
                    <TextBlock Text="{Binding StatusText}"
                               VerticalAlignment="Center"
                               FontSize="12"/>
                </StackPanel>
            </Border>

            <!-- Main Content -->
            <Grid ColumnDefinitions="*,*" Margin="16">
                <!-- Left Panel - Your Credentials -->
                <Border Grid.Column="0"
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Margin="0,0,8,0">
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                        <!-- Row 0: Title -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                                   Text="Your Credentials"
                                   FontWeight="SemiBold"
                                   FontSize="16"
                                   Margin="0,0,0,12"/>

                        <!-- Row 1: ID Label + Value -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Spacing="4">
                            <TextBlock Text="ID"
                                       FontSize="12"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            <SelectableTextBlock Text="{Binding YourUsername}"
                                                 Margin="0,8,0,0"
                                                 FontFamily="Consolas, Courier New, monospace"
                                                 FontSize="18"
                                                 FontWeight="Bold"/>
                        </StackPanel>

                        <!-- Copy button - spans rows 1-2, vertically centered -->
                        <Button Grid.Row="1" Grid.RowSpan="2" Grid.Column="1"
                                VerticalAlignment="Center"
                                Command="{Binding CopyCredentialsCommand}"
                                ToolTip.Tip="Copy ID and password"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="32" Height="32"
                                Padding="0"
                                Margin="8,0,0,0">
                            <mi:MaterialIcon Kind="ContentCopy" Width="20" Height="20"
                                             Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                        </Button>

                        <!-- Row 2: Password Label + Value with Refresh -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Spacing="4" Margin="0,12,0,0">
                            <TextBlock Text="Password"
                                       FontSize="12"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <SelectableTextBlock Text="{Binding YourPassword}"
                                                     Margin="0,8,0,2"
                                                     FontFamily="Consolas, Courier New, monospace"
                                                     FontSize="18"
                                                     FontWeight="Bold"
                                                     VerticalAlignment="Center"/>
                                <Button Command="{Binding GenerateNewPasswordCommand}"
                                        ToolTip.Tip="Generate new password"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Width="28" Height="28"
                                        Padding="0"
                                        VerticalAlignment="Center">
                                    <mi:MaterialIcon Kind="Refresh" Width="18" Height="18"
                                                     Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Right Panel - Connect to Device -->
                <Border Grid.Column="1"
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Margin="8,0,0,0">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Connect to Device"
                                   FontWeight="SemiBold"
                                   FontSize="16"/>

                        <StackPanel Spacing="4">
                            <TextBlock Text="ID"
                                       FontSize="12"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            <TextBox x:Name="TargetUsernameBox"
                                     Text="{Binding TargetUsername}"
                                     Watermark="Enter ID"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     PastingFromClipboard="TargetUsernameBox_Pasting"/>
                        </StackPanel>

                        <StackPanel Spacing="4">
                            <TextBlock Text="Password"
                                       FontSize="12"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            <TextBox x:Name="TargetPasswordBox"
                                     Text="{Binding TargetPassword}"
                                     Watermark="Enter password"
                                     PasswordChar="*"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     KeyDown="TargetPasswordBox_KeyDown">
                                <TextBox.InnerRightContent>
                                    <Button Command="{Binding ConnectToDeviceCommand}"
                                            ToolTip.Tip="Connect"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="4"
                                            IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}">
                                        <mi:MaterialIcon Kind="ArrowRightCircle" Width="20" Height="20"
                                                         Foreground="{DynamicResource SystemAccentColor}"/>
                                    </Button>
                                </TextBox.InnerRightContent>
                            </TextBox>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </DockPanel>

        <toastControls:ToastsView DataContext="{Binding Toasts}"
                                  VerticalAlignment="Bottom"
                                  HorizontalAlignment="Right"
                                  Margin="0,0,8,8"/>

        <!-- Version Mismatch Warning Banner (overlay) -->
        <Border VerticalAlignment="Top"
                HorizontalAlignment="Stretch"
                Background="#FFF3CD"
                Padding="12,8"
                IsVisible="{Binding HasVersionMismatch}">
            <Grid ColumnDefinitions="Auto,*">
                <mi:MaterialIcon Kind="AlertOutline"
                                 Width="20" Height="20"
                                 Foreground="#856404"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding VersionMismatchText}"
                           Foreground="#856404"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Panel>
</Window>
