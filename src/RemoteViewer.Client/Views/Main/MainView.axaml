<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:RemoteViewer.Client.Controls"
        xmlns:vm="using:RemoteViewer.Client.Views.Main"
        xmlns:conv="using:RemoteViewer.Client.Converters"
        xmlns:toastControls="using:RemoteViewer.Client.Controls.Toasts"
        xmlns:mi="using:Material.Icons.Avalonia"
        xmlns:mik="using:Material.Icons"
        xmlns:theme="using:RemoteViewer.Client.Themes"

        x:Class="RemoteViewer.Client.Views.Main.MainView"
        x:DataType="vm:MainViewModel"

        Icon="/Assets/avalonia-logo.ico"
        Title="Remote Viewer"
        CanResize="False"

        SizeToContent="Height"
        Width="500"

        DataContextChanged="Window_DataContextChanged">
    <Grid RowDefinitions="*,Auto">

        <!-- Main Content -->
        <Grid Grid.Row="0"
              Margin="{theme:Spacing LG}"
              Grid.IsSharedSizeScope="True">
            <Grid.ColumnDefinitions>
               <ColumnDefinition Width="*" />
               <ColumnDefinition Width="{theme:Spacing All=LG}" />
               <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Your Credentials -->
            <controls:Card Grid.Column="0">
                <Grid ColumnDefinitions="*,Auto">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" SharedSizeGroup="HeaderRow"/>
                            <RowDefinition Height="{theme:Spacing All=SM}" />
                            <RowDefinition Height="Auto" SharedSizeGroup="IdLabelRow"/>
                            <RowDefinition Height="{theme:Spacing All=XS}" />
                            <RowDefinition Height="Auto" SharedSizeGroup="IdValueRow"/>
                            <RowDefinition Height="{theme:Spacing All=SM}" />
                            <RowDefinition Height="Auto" SharedSizeGroup="PasswordLabelRow"/>
                            <RowDefinition Height="{theme:Spacing All=XS}" />
                            <RowDefinition Height="Auto" SharedSizeGroup="PasswordValueRow"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Classes="h2"
                                   Text="Your Credentials" />

                        <TextBlock Grid.Row="2"
                                   Classes="m1 muted"
                                   Text="ID" />

                        <SelectableTextBlock Grid.Row="4"
                                             Text="{Binding YourUsername}"
                                             Classes="credential"
                                             VerticalAlignment="Center" />

                        <TextBlock Grid.Row="6"
                                   Classes="m1 muted"
                                   Text="Password" />

                        <StackPanel Grid.Row="8"
                                    Orientation="Horizontal"
                                    Spacing="{theme:Spacing XS}">
                            <SelectableTextBlock Text="{Binding YourPassword}"
                                                    Classes="credential"
                                                    VerticalAlignment="Center"/>
                            <Button Command="{Binding GenerateNewPasswordCommand}"
                                    ToolTip.Tip="Generate new password"
                                    Classes="icon-button"
                                    VerticalAlignment="Center"
                                    Width="32" 
                                    Height="32">
                                <mi:MaterialIcon Kind="Refresh"
                                                 Classes="icon-xs"
                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <Button Grid.Column="1"
                            Classes="icon-button"
                            VerticalAlignment="Center"
                            Margin="{theme:Spacing Left=SM}"
                            Command="{Binding CopyCredentialsCommand}"
                            ToolTip.Tip="Copy ID and password">
                        <mi:MaterialIcon Kind="ContentCopy"
                                         Classes="icon-sm"
                                         Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                </Grid>
            </controls:Card>

            <!-- Right Panel - Connect to Device -->
            <controls:Card Grid.Column="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" SharedSizeGroup="HeaderRow"/>
                        <RowDefinition Height="{theme:Spacing All=SM}" />
                        <RowDefinition Height="Auto" SharedSizeGroup="IdLabelRow"/>
                        <RowDefinition Height="{theme:Spacing All=XS}" />
                        <RowDefinition Height="Auto" SharedSizeGroup="IdValueRow"/>
                        <RowDefinition Height="{theme:Spacing All=SM}" />
                        <RowDefinition Height="Auto" SharedSizeGroup="PasswordLabelRow"/>
                        <RowDefinition Height="{theme:Spacing All=XS}" />
                        <RowDefinition Height="Auto" SharedSizeGroup="PasswordValueRow"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Classes="h2"
                               Text="Connect to Device" />

                    <TextBlock Grid.Row="2"
                               Classes="m1 muted"
                               Text="ID" />

                    <TextBox Grid.Row="4"
                             x:Name="TargetUsernameBox"
                             Text="{Binding TargetUsername}"
                             Watermark="Enter ID"
                             IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                             PastingFromClipboard="TargetUsernameBox_Pasting" />

                    <TextBlock Grid.Row="6"
                               Classes="m1 muted"
                               Text="Password" />

                    <TextBox Grid.Row="8"
                             x:Name="TargetPasswordBox"
                             Text="{Binding TargetPassword}"
                             Watermark="Enter password"
                             IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                             PasswordChar="â—"
                             KeyDown="TargetPasswordBox_KeyDown">
                        <TextBox.InnerRightContent>
                            <Button Command="{Binding ConnectToDeviceCommand}"
                                    ToolTip.Tip="Connect"
                                    Classes="icon-button"
                                    IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}">
                                <mi:MaterialIcon Kind="ArrowRightCircle"
                                                 Classes="icon-sm"
                                                 Foreground="{DynamicResource AccentBrush}"/>
                            </Button>
                        </TextBox.InnerRightContent>
                    </TextBox>
                </Grid>
            </controls:Card>
        </Grid>

        <!-- Status Bar at Bottom -->
        <Border Grid.Row="1"
                Background="{DynamicResource SurfaceElevatedBrush}"
                Padding="{theme:Spacing X=LG, Y=XXS}">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Orientation="Horizontal"
                            Spacing="{theme:Spacing SM}"
                            ToolTip.Tip="{Binding VersionTooltipText}">
                    <mi:MaterialIcon Classes="icon-xs">
                        <mi:MaterialIcon.Kind>
                            <Binding Path="Status">
                                <Binding.Converter>
                                    <conv:ObjectToObject DefaultValue="{x:Static mik:MaterialIconKind.CloudOffOutline}">
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.Connected}" To="{x:Static mik:MaterialIconKind.CloudCheck}"/>
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.VersionMismatch}" To="{x:Static mik:MaterialIconKind.AlertOutline}"/>
                                    </conv:ObjectToObject>
                                </Binding.Converter>
                            </Binding>
                        </mi:MaterialIcon.Kind>
                        <mi:MaterialIcon.Foreground>
                            <Binding Path="Status">
                                <Binding.Converter>
                                    <conv:ObjectToObject DefaultValue="{StaticResource ErrorBrush}">
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.Connected}" To="{StaticResource SuccessBrush}"/>
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.VersionMismatch}" To="{StaticResource WarningBrush}"/>
                                    </conv:ObjectToObject>
                                </Binding.Converter>
                            </Binding>
                        </mi:MaterialIcon.Foreground>
                    </mi:MaterialIcon>
                    <TextBlock Classes="m1"
                               VerticalAlignment="Center">
                        <TextBlock.Text>
                            <Binding Path="Status">
                                <Binding.Converter>
                                    <conv:ObjectToObject DefaultValue="Connecting...">
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.Connected}" To="Connected"/>
                                        <conv:MapItem From="{x:Static vm:ConnectionStatus.VersionMismatch}" To="Version Mismatch"/>
                                    </conv:ObjectToObject>
                                </Binding.Converter>
                            </Binding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>

                <Button Grid.Column="1"
                        Command="{Binding ShowAboutCommand}"
                        ToolTip.Tip="About"
                        Classes="icon-button"
                        Width="24" 
                        Height="24">
                    <mi:MaterialIcon Kind="InformationOutline"
                                     Classes="icon-xs"
                                     Foreground="{DynamicResource TextSecondaryBrush}"/>
                </Button>
            </Grid>
        </Border>

        <!-- Toast Notifications -->
        <toastControls:ToastsView Grid.RowSpan="2"
                                  DataContext="{Binding Toasts}"
                                  HorizontalAlignment="Right"
                                  VerticalAlignment="Bottom"
                                  Margin="{theme:Spacing Right=SM, Bottom=SM}"/>
    </Grid>
</Window>
