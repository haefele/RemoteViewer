<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="using:RemoteViewer.Client.Controls"
        xmlns:vm="using:RemoteViewer.Client.Views.Main"
        xmlns:conv="using:RemoteViewer.Client.Converters"
        xmlns:toastControls="using:RemoteViewer.Client.Controls.Toasts"
        xmlns:mi="using:Material.Icons.Avalonia"
        xmlns:mik="using:Material.Icons"
        xmlns:theme="using:RemoteViewer.Client.Themes"

        x:Class="RemoteViewer.Client.Views.Main.MainView"
        x:DataType="vm:MainViewModel"

        Icon="/Assets/avalonia-logo.ico"
        Title="Remote Viewer"
        CanResize="False"

        SizeToContent="Height"
        Width="500"

        DataContextChanged="Window_DataContextChanged">
    <Panel>
        <Grid RowDefinitions="*,Auto">
            <!-- Main Content -->
            <Grid Grid.Row="0" ColumnDefinitions="*,*" Margin="{theme:Spacing LG}">
                <!-- Left Panel - Your Credentials -->
                <controls:Card Grid.Column="0"
                               Margin="{theme:Spacing Right=SM}">
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                        <!-- Row 0: Title -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                                   Text="Your Credentials"
                                   Classes="header"
                                   Margin="{theme:Spacing Bottom=MD}"/>

                        <!-- Row 1: ID Label + Value -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Spacing="{theme:Gap XS}">
                            <TextBlock Text="ID"
                                       Classes="caption secondary"/>
                            <SelectableTextBlock Text="{Binding YourUsername}"
                                                 Classes="credential"
                                                 Margin="{theme:Spacing Y=SM}"/>
                        </StackPanel>

                        <!-- Copy button - spans rows 1-2, vertically centered -->
                        <Button Grid.Row="1" Grid.RowSpan="2" Grid.Column="1"
                                Classes="icon-button"
                                VerticalAlignment="Center"
                                Margin="{theme:Spacing Left=SM}"
                                Command="{Binding CopyCredentialsCommand}"
                                ToolTip.Tip="Copy ID and password">
                            <mi:MaterialIcon Kind="ContentCopy" Width="20" Height="20"
                                             Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </Button>

                        <!-- Row 2: Password Label + Value with Refresh -->
                        <StackPanel Grid.Row="2" Grid.Column="0"
                                    Spacing="{theme:Gap XS}"
                                    Margin="{theme:Spacing Top=MD}">
                            <TextBlock Text="Password"
                                       Classes="caption secondary"/>
                            <StackPanel Orientation="Horizontal" Spacing="{theme:Gap XS}">
                                <SelectableTextBlock Text="{Binding YourPassword}"
                                                     Classes="credential"
                                                     Margin="{theme:Spacing Y=SM}"
                                                     VerticalAlignment="Center"/>
                                <Button Command="{Binding GenerateNewPasswordCommand}"
                                        ToolTip.Tip="Generate new password"
                                        Classes="icon-button"
                                        VerticalAlignment="Center"
                                        Width="28" Height="28">
                                    <mi:MaterialIcon Kind="Refresh" Width="18" Height="18"
                                                     Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </controls:Card>

                <!-- Right Panel - Connect to Device -->
                <controls:Card Grid.Column="1"
                               Margin="{theme:Spacing Left=SM}">
                    <StackPanel Spacing="{theme:Gap MD}">
                        <TextBlock Text="Connect to Device"
                                   Classes="header"/>

                        <StackPanel Spacing="{theme:Gap XS}">
                            <TextBlock Text="ID"
                                       Classes="caption secondary"/>
                            <TextBox x:Name="TargetUsernameBox"
                                     Text="{Binding TargetUsername}"
                                     Watermark="Enter ID"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     PastingFromClipboard="TargetUsernameBox_Pasting"/>
                        </StackPanel>

                        <StackPanel Spacing="{theme:Gap XS}">
                            <TextBlock Text="Password"
                                       Classes="caption secondary"/>
                            <TextBox x:Name="TargetPasswordBox"
                                     Text="{Binding TargetPassword}"
                                     Watermark="Enter password"
                                     PasswordChar="*"
                                     IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}"
                                     KeyDown="TargetPasswordBox_KeyDown">
                                <TextBox.InnerRightContent>
                                    <Button Command="{Binding ConnectToDeviceCommand}"
                                            ToolTip.Tip="Connect"
                                            Classes="icon-button"
                                            Padding="{theme:Spacing XS}"
                                            IsEnabled="{Binding !ConnectToDeviceCommand.IsRunning}">
                                        <mi:MaterialIcon Kind="ArrowRightCircle" Width="20" Height="20"
                                                         Foreground="{DynamicResource AccentBrush}"/>
                                    </Button>
                                </TextBox.InnerRightContent>
                            </TextBox>
                        </StackPanel>
                    </StackPanel>
                </controls:Card>
            </Grid>

            <!-- Status Bar at Bottom -->
            <Border Grid.Row="1"
                    Background="{DynamicResource SurfaceElevatedBrush}"
                    Padding="{theme:Spacing X=MD, Y=SM}">
                <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Orientation="Horizontal" Spacing="{theme:Gap SM}">
                        <mi:MaterialIcon Kind="{Binding IsConnected, Converter={conv:BoolToObject TrueValue={x:Static mik:MaterialIconKind.CloudCheck}, FalseValue={x:Static mik:MaterialIconKind.CloudOffOutline}}}"
                                         Width="{StaticResource IconSizeSM}" Height="{StaticResource IconSizeSM}"
                                         Foreground="{Binding IsConnected, Converter={conv:BoolToObject TrueValue={StaticResource SuccessBrush}, FalseValue={StaticResource ErrorBrush}}}"/>
                        <TextBlock Text="{Binding StatusText}"
                                   Classes="caption"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Command="{Binding ShowAboutCommand}"
                            ToolTip.Tip="About"
                            Classes="icon-button"
                            Width="24" Height="24">
                        <mi:MaterialIcon Kind="InformationOutline" Width="16" Height="16"
                                         Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <toastControls:ToastsView DataContext="{Binding Toasts}"
                                  HorizontalAlignment="Right"
                                  VerticalAlignment="Bottom"
                                  Margin="{theme:Spacing Right=SM, Bottom=SM}"/>

        <!-- Version Mismatch Warning Banner (overlay) -->
        <Border HorizontalAlignment="Stretch"
                VerticalAlignment="Top"
                Padding="{theme:Spacing X=MD, Y=SM}"
                Background="{DynamicResource WarningBackgroundBrush}"
                IsVisible="{Binding HasVersionMismatch}">
            <Grid ColumnDefinitions="Auto,*">
                <mi:MaterialIcon Kind="AlertOutline"
                                 Width="20" Height="20"
                                 Foreground="{DynamicResource WarningForegroundBrush}"
                                 VerticalAlignment="Center"
                                 Margin="{theme:Spacing Right=MD}"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding VersionMismatchText}"
                           Foreground="{DynamicResource WarningForegroundBrush}"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Panel>
</Window>
