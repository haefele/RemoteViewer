<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:toasts="using:RemoteViewer.Client.Controls.Toasts"
             xmlns:ft="using:RemoteViewer.Client.Services.FileTransfer"
             xmlns:conv="using:RemoteViewer.Client.Converters"
             x:Class="RemoteViewer.Client.Controls.Toasts.ToastsView"
             x:DataType="toasts:ToastsViewModel">

    <ItemsControl ItemsSource="{Binding Items}">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Spacing="8"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>

        <ItemsControl.DataTemplates>
            <!-- Regular text toast -->
            <DataTemplate x:DataType="toasts:ToastItemViewModel">
                <Border CornerRadius="4"
                        Padding="8"
                        MaxWidth="280"
                        MinWidth="180"
                        Background="{Binding Type, Converter={x:Static conv:ToastTypeToBackgroundConverter.Instance}}">
                    <Border.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
                        </Transitions>
                    </Border.Transitions>

                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <mi:MaterialIcon Grid.Column="0"
                                         Kind="{Binding Type, Converter={x:Static conv:ToastTypeToIconConverter.Instance}}"
                                         Width="16"
                                         Height="16"
                                         VerticalAlignment="Center"
                                         Foreground="White"
                                         Margin="0,0,8,0"/>

                        <TextBlock Grid.Column="1"
                                   Text="{Binding Message}"
                                   VerticalAlignment="Center"
                                   TextWrapping="Wrap"
                                   Foreground="White"
                                   Margin="0,0,12,0"/>

                        <Button Grid.Column="2"
                                Command="{Binding DismissCommand}"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="24"
                                Height="24"
                                Padding="0"
                                VerticalAlignment="Center"
                                Cursor="Hand">
                            <mi:MaterialIcon Kind="Close"
                                             Width="14"
                                             Height="14"
                                             Foreground="White"/>
                        </Button>
                    </Grid>
                </Border>
            </DataTemplate>

            <!-- File transfer progress toast -->
            <DataTemplate x:DataType="toasts:TransferToastItemViewModel">
                <Border CornerRadius="4"
                        Padding="12"
                        MaxWidth="300"
                        MinWidth="250"
                        Background="#E0333333">
                    <Border.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
                        </Transitions>
                    </Border.Transitions>

                    <Grid RowDefinitions="Auto,Auto,Auto">
                        <!-- Header: Icon, Filename, Cancel button -->
                        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,8">
                            <mi:MaterialIcon Grid.Column="0"
                                             Kind="{Binding IsUpload, Converter={x:Static conv:BoolToUploadDownloadIconConverter.Instance}}"
                                             Width="16"
                                             Height="16"
                                             VerticalAlignment="Center"
                                             Foreground="White"
                                             Margin="0,0,8,0"/>

                            <TextBlock Grid.Column="1"
                                       Text="{Binding Transfer.FileName, FallbackValue=Requesting...}"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis"
                                       Foreground="White"
                                       FontWeight="SemiBold"
                                       ToolTip.Tip="{Binding Transfer.FileName}"/>

                            <Button Grid.Column="2"
                                    Command="{Binding CancelCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Width="24"
                                    Height="24"
                                    Padding="0"
                                    VerticalAlignment="Center"
                                    Cursor="Hand"
                                    ToolTip.Tip="Cancel transfer">
                                <mi:MaterialIcon Kind="Close"
                                                 Width="14"
                                                 Height="14"
                                                 Foreground="#AAAAAA"/>
                            </Button>
                        </Grid>

                        <!-- Progress bar -->
                        <ProgressBar Grid.Row="1"
                                     Value="{Binding Transfer.Progress}"
                                     Minimum="0"
                                     Maximum="1"
                                     Height="4"
                                     CornerRadius="2"
                                     Foreground="{Binding IsUpload, Converter={x:Static conv:BoolToUploadDownloadColorConverter.Instance}}"
                                     Background="#555555"/>

                        <!-- Size and percentage -->
                        <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="0,6,0,0">
                            <TextBlock Grid.Column="0"
                                       Text="{Binding Transfer.FileSizeFormatted}"
                                       Foreground="#AAAAAA"
                                       FontSize="11"/>

                            <TextBlock Grid.Column="1"
                                       Text="{Binding Transfer.ProgressPercent, StringFormat={}{0}%}"
                                       Foreground="#AAAAAA"
                                       FontSize="11"/>
                        </Grid>
                    </Grid>
                </Border>
            </DataTemplate>
        </ItemsControl.DataTemplates>
    </ItemsControl>
</UserControl>
